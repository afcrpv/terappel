= simple_form_for dossier, html: { class: "form-horizontal saisie"} do |f|
  - if f.error_notification
    .alert-message.warning.fade.in{"data-alert" => "alert"}
      %a.close{href: "#"}x
      %p= f.error_notification

  #tabs
    %ul
      %li= link_to "Informations générales", "#infos"
      %li= link_to "Grossesse", "#grossesse"
      %li= link_to "Exposition", "#expositions"
      %li= link_to "Evolution", "#evol"
      %li= link_to "Nouveau-né", "#bebes"

    #infos
      = f.input :user_id, as: :hidden
      = f.input :centre_id, as: :hidden
      = f.input :code
      = f.input :date_appel, as: :string, input_html: {autofocus: true, "data-value" => date_appel, class: "dateITA dateNotFuture"}
      = f.association :motif
      .inline-inputs
        = f.label "Correspondant"
        = f.autocomplete_field :correspondant_nom,
          autocomplete_correspondant_fullname_dossiers_path,
          id_element: "#dossier_correspondant_id", class: "span8"
        = link_to "Ajout", new_correspondant_path, target: "_blank", class: "btn create-correspondant" if can?(:create, Correspondant)
        = link_to "Voir/modifier", "#", target: "_blank", class: "btn edit-correspondant" if can?(:update, Correspondant)
      = f.input :correspondant_id, as: :hidden

    #grossesse
      .inline-inputs
        = f.label :name, "Nom"
        = f.text_field :name
        = f.label :prenom, "Prénom", class: "inline"
        = f.text_field :prenom
        = f.label :age, class: "inline"
        = f.text_field :age, class: "span1"
      = f.association :categoriesp
      = f.input :antecedents_fam, collection: Dossier::ONI,
        as: :radio_buttons, item_wrapper_class: "inline"
      = f.input :antecedents_perso, collection: Dossier::ONI,
        as: :radio_buttons, item_wrapper_class: "inline"
      = f.input :tabac, collection: Dossier::TABAC,
        as: :radio_buttons, item_wrapper_class: "inline"
      = f.input :alcool, collection: Dossier::ALCOOL,
        as: :radio_buttons, item_wrapper_class: "inline"

    #expositions
      %table.fields_summary#expositions_summary
        %thead
          %tr
            %th#action
            %th#exposition Exposition
            %th#terme Terme
            %th#indication Indication
            %th Posologie
            %th De
            %th.to à
            %th Et de
            %th.to à
        %tbody

      = f.simple_fields_for :expositions do |exposition|
        = render 'exposition_fields', :f => exposition
      .links= link_to_add_association 'Ajouter Expo', f, :expositions, class: "btn primary small"

    #evol

    #bebes
      %table.fields_summary#bebes_summary
        %thead
          %tr
            %th#action
            %th Sexe
            %th Apgar (1')
            %th Apgar (5')
            %th Poids
            %th Taille
            %th PC
            %th Malformation
            %th Pathologie
        %tbody

      = f.simple_fields_for :bebes do |bebe|
        = render 'bebe_fields', :f => bebe
      .links= link_to_add_association 'Ajouter Nouveau-né', f, :bebes, class: "btn primary small"

  .actions
    = f.button :submit, disable_with: "Attendre...", class: "success"
    = link_to "Annuler", dossiers_path, class: "btn"

= content_for :footer do
  = debug "\nCentre : " + dossier.try(:centre_name) + "\nUser : " + dossier.username
